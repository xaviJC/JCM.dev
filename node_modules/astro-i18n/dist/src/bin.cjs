#!/usr/bin/env node
"use strict";var Do=Object.create;var Pe=Object.defineProperty;var Fo=Object.getOwnPropertyDescriptor;var Mo=Object.getOwnPropertyNames;var Vo=Object.getPrototypeOf,Go=Object.prototype.hasOwnProperty;var Uo=(e,t,r)=>t in e?Pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var zo=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Mo(t))!Go.call(e,o)&&o!==r&&Pe(e,o,{get:()=>t[o],enumerable:!(n=Fo(t,o))||n.enumerable});return e};var Bo=(e,t,r)=>(r=e!=null?Do(Vo(e)):{},zo(t||!e||!e.__esModule?Pe(r,"default",{value:e,enumerable:!0}):r,e));var Ee=(e,t,r)=>(Uo(e,typeof t!="symbol"?t+"":t,r),r),Se=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var f=(e,t,r)=>(Se(e,t,"read from private field"),r?r.call(e):t.get(e)),T=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},A=(e,t,r,n)=>(Se(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);var P=(e,t,r)=>(Se(e,t,"access private method"),r);var Ne=class extends Error{constructor(){super("An unexpected format of `process.argv` was found.")}},Ir=Ne;var Le=class extends Error{constructor(){super("No CLI arguments were found.")}},Cr=Le;var Oe=class extends Error{constructor(){super("`process` global is undefined.")}},$r=Oe;function jr(e){if(!process||!process.argv)throw new $r;let[t,r,...n]=process.argv;if(!t||!r)throw new Ir;if(n.length===0)throw new Cr;let o={node:t,filename:r,command:null,args:[],options:{}},i=!1;for(let[s,c]of n.entries()){if(s===0){if(!e.some(a=>a.name===c))return o;o.command=c;continue}if(c.startsWith("-")||i){if(!c.startsWith("--"))return o;i=!0;let a=e.find(p=>p.name===o.command)?.options||Jo(),l=c.replace("--",""),u=l.indexOf("=");if(u<0){if(!a.includes(l))return o;o.options[l]=!0;continue}o.options[l.slice(0,u)]=l.slice(u+1);continue}o.args.push(c)}return o}function Jo(){throw new Error("Unreachable code executed.")}var ve=class extends Error{constructor(){super("Invalid command.")}},Y=ve;var wt,lt,Nt,St=class{static get path(){return P(this,lt,Nt).call(this,"path")}static get posix(){return this.path.then(({posix:t})=>t)}static get fs(){return P(this,lt,Nt).call(this,"fs")}static get url(){return P(this,lt,Nt).call(this,"url")}static get module(){return P(this,lt,Nt).call(this,"module")}};wt=new WeakMap,lt=new WeakSet,Nt=async function(t){if(f(this,wt)[t])return f(this,wt)[t];let r=await import(`node:${t}`);return f(this,wt)[t]=r,r},T(St,lt),T(St,wt,{});var d=St;async function I(e){let{sep:t,posix:r}=await d.path;return e.split(t).join(r.sep)}async function ft(e){let t=await Mr(e),r=e.split(t);return r.pop(),r.join(t)}async function Dr(e){let t=await Mr(e);return e.split(t)}function Fr(e){switch(e){case"":return!0;case"/":return!0;case"\\":return!0;default:return!/[/\\]/.test(e)}}async function Mr(e){let{sep:t}=await d.path,r=e.split("/").length-1,n=e.split("\\").length-1;return r>n?"/":n>r?"\\":t}var ke=class extends Error{constructor(t){super(t?`Invalid path (${t}).`:"Invalid path.")}},Vr=ke;async function N(e){if(!e)return!1;let{existsSync:t,lstatSync:r}=await d.fs;return t(e)&&r(e).isDirectory()}async function v(e){if(!e)return!1;let{existsSync:t,lstatSync:r}=await d.fs;return t(e)&&!r(e).isDirectory()}async function Gr(e){let{accessSync:t,constants:r}=await d.fs;try{return t(e,r.R_OK),!0}catch{return!1}}async function _e(e,t){let{readdirSync:r}=await d.fs,n=r(e);await t(await I(e),n);for(let o of n){let i=`${e}/${o}`;await N(i)&&await _e(i,t)}}async function Q(e,t){let{sep:r,join:n}=await d.path,{writeFileSync:o,mkdirSync:i}=await d.fs,s=await Dr(e),c=s.pop();if(!c)throw new Vr;let a=s.join(r);i(a,{recursive:!0}),o(n(a,c),t,{encoding:"utf8"})}async function Ur(e){let{rmSync:t}=await d.fs;t(e,{recursive:!0,force:!0})}var Ie=class extends Error{constructor(t){super(t?`Unable to find project root. ${t}`:"Unable to find project root.")}},H=Ie;var Ce=class extends Error{constructor(t){super(t?`Peer dependency \`${t}\` was not found, if it's not already done try installing it.`:"A dependency was not found.")}},zr=Ce;var $e=class extends Error{constructor(t){super(t?`No file was found for the given path (${t}).`:"No file was found for the given path.")}},je=$e;var De=class extends Error{constructor(t=[]){super(t.length>0?`Invalid file type, supported formats are: "${t.join('", "')}"`:"Invalid file type, format not supported.")}},Fe=De;var Me=class extends Error{constructor(t){super(t?`Invalid format, could not parse JSON (${t}).`:"Invalid format, could not parse JSON.")}},Br=Me;async function Jr(e){let t=null;t=await import("esbuild");let r=/\.(js|cjs|mjs|ts)$/;if(!v(e))throw new je(e);if(!r.test(e))throw new Fe(["js","cjs","mjs","ts"]);try{let{outputFiles:n}=await t.build({entryPoints:[e],bundle:!0,external:["esbuild"],format:"cjs",platform:"node",write:!1}),o=new TextDecoder().decode(n[0]?.contents);return o?qo(o,e.replace(r,".cjs")):{}}catch{throw new zr("esbuild")}}async function j(e){if(!v(e))throw new je(e);if(!/\.json$/.test(e))throw new Fe(["json"]);let{readFileSync:t}=await d.fs,r=t(e,{encoding:"utf8"});try{return JSON.parse(r)}catch{throw new Br(e)}}async function qo(e,t){let{Module:r}=await d.module,n=t.split("/").slice(0,-1).join("/"),o={module:new r(t),require(i){return this.module.require(i)}};return o.module.paths=r._nodeModulePaths(n),o.module.filename=t,o.module.exports={},o.require=i=>o.module.require(i),Object.assign(o.require,{resolve:i=>r._resolveFilename(i,o.module)}),new Function("exports","require","module","__filename","__dirname",e)(o.module.exports,o.require,o.module,t,n),o.module.exports}var E="astro-i18n",qr=`${E}.config`,Ve="github.com/alexandre-fernandez/astro-i18n/issues";var Ge=class extends Error{constructor(t){super(t?`${E}: Unreachable code executed (at "${t}"), please open an issue at "${Ve}".`:`${E}: Unreachable code executed, please open an issue at "${Ve}".`)}},Kr=Ge;function y(){throw new Kr}function Wr(e=new Error("Something went wrong.")){throw e}function k(e,t,r){let{mode:n,mutable:o}={mode:"replace",mutable:!0,...r},i=o?e:structuredClone(e);for(let[s,c]of Object.entries(t)){let a=i[s];if(Object.hasOwn(i,s)){Ue(a)&&Ue(c)?k(a,c):n==="replace"&&(i[s]=t[s]);continue}i[s]=t[s]}return o?void 0:i}function V(e,t,r){let n=typeof t=="string"?[t]:t,o=e;for(let[i,s]of n.entries()){if(i===n.length-1){o[s]=r;break}Ue(o[s])||(o[s]={}),o=o[s]}}function Ue(e){return typeof e!="object"?!1:Object.getPrototypeOf(e)===Object.prototype}function G(e,t,r){if(!t(e)){let n="";throw e?typeof e=="object"?n=`
${e.constructor.name}
${JSON.stringify(e,null,4)}`:typeof e=="symbol"?n=`Symbol("${e.description}")`:n=typeof e=="string"?`"${e}"`:`${e}`:n=`${e}`,!r&&t.name.startsWith("is")&&(r=t.name.slice(2)),new TypeError(r?`Unexpected type (expecting \`${r}\`), found: ${n}`:`Unexpected type, found: ${n}`)}}function Yr(e){return typeof e=="number"&&!Number.isNaN(e)}function Hr(e){return e instanceof Date&&!Number.isNaN(e.getTime())}function ut(e){return Array.isArray(e)}function st(e){return ut(e)&&e.every(t=>typeof t=="string")}function w(e){return!!e&&typeof e=="object"}function Lt(e){return w(e)?Object.getPrototypeOf(e)===Object.prototype:!1}var zt,Xr,Tt=class{constructor(t){T(this,zt);Ee(this,"regexp");this.regexp=new RegExp(t.source,t.flags)}static fromString(t,r){return new Tt(new RegExp(t,r))}get source(){return this.regexp.source}get flags(){return this.regexp.flags}add(t){return this.regexp=new RegExp(`${this.regexp.source}${t.source}`,this.regexp.flags),this}test(t){return this.regexp.test(t)}exec(t,r){let n=P(this,zt,Xr).call(this,t),o=n.next();for(;!o.done&&r(o.value)!==Tt.BREAK;)o=n.next();return this}match(t){let r=null;return this.exec(t,n=>(r=n,Tt.BREAK)),r}clone(){return new Tt(new RegExp(this.regexp.source,this.regexp.flags))}toMatcher(){return this.match.bind(this)}},Ut=Tt;zt=new WeakSet,Xr=function*(t){let r=this.regexp;r.flags.includes("g")||(r=new RegExp(this.regexp.source,`${this.regexp.flags}g`));let n=r.exec(t);for(;n!==null;)n&&(yield{range:[n.index,n.index+n[0].length],match:[...n]}),n=r.exec(t)},Ee(Ut,"BREAK","break");var m=Ut;var Ot=class{#e;#t;constructor({source:t,flags:r}){this.#e=t,this.#t=r}static fromRegex(t){return new Ot(t.regexp)}appendPattern(t){return this.#e=`${this.#e}${t}`,this}matchTrimifiable(){return this.#e=`\\s*${this.#e}\\s*`,this}assertStarting(){return this.#e=`^${this.#e}`,this}assertEnding(){return this.#e=`${this.#e}$`,this}addGroup(){return this.#e=`(${this.#e})`,this}addGlobalFlag(){return this.#t.includes("g")||(this.#t=`${this.#t}g`),this}build(){return new m(new RegExp(this.#e,this.#t))}},_=Ot;var U="break",Zr=["json","js","cjs","mjs","ts"],X="i18n",D="pages";var ze=class extends Error{constructor(){super(`Could not find astro "${D}" directory.`)}},Qr=ze;var tn=new m(/(\/[^\s/]+)?(\/[^\s/]+)\.astro$/),Bt=new m(/^---\n([\S\s]+)\n---\n/),en=new m(/export\s*(?:const\s+prerender|var\s+prerender|let\s+prerender|prerender)(?:\s*=\s*)?(true|false)?|export\s*?{\s*?prerender\s*?}/),rn=new m(/export\s+(?:async\s+)?(?:function\s+|const\s+|var\s+|let\s+)getStaticPaths|export\s*{\s*getStaticPaths\s*}/);var Be=class{#e;#t;#r;#a;#c;#s=void 0;#n=void 0;#o=null;#i=null;constructor({name:t,route:r,path:n,translations:o,routes:i}){this.#e=t,this.#t=r,this.#r=n,this.#a=o,this.#c=i}get name(){return this.#e}get route(){return this.#t}get path(){return this.#r}get translations(){return this.#a}get routes(){return this.#c}async getContent(){if(this.#o)return this.#o;let{readFileSync:t}=await d.fs;return this.#o=t(this.#r,{encoding:"utf8"}),this.#i=Bt.match(this.#o)?.match[0]||null,this.#o}async getFrontmatter(){return this.#i?this.#i:(this.getContent(),this.#i)}async hasGetStaticPaths(){if(typeof this.#s<"u")return this.#s;let{readFileSync:t}=await d.fs,r=t(this.#r,{encoding:"utf8"}),n=Bt.match(r)?.match[0];return this.#s=n?rn.test(n):!1,this.#s}async prerender(){if(typeof this.#n<"u")return this.#n;let{readFileSync:t}=await d.fs,r=t(this.#r,{encoding:"utf8"}),n=Bt.match(r)?.match[0];if(!n)return this.#n=!1,this.#n;let{match:o}=en.match(n)||{};return o?o[1]?this.#n=o[1]==="true":this.#n=!0:this.#n=null,this.#n}async getProxy(t,r){let n=this.path.lastIndexOf("src/pages");if(n=n<0?null:n+9,!n)return null;let o="";t=t.replace(/\/$/,"")||"/";let i=this.#r.slice(n),s=t.split("/").length-1,c=`${"../".repeat(s)}${i.slice(1)}`;if(o+=`---
import Page from "${c}"
`,await this.hasGetStaticPaths()){let{locale:l,route:u}=r.internals.splitLocaleAndRoute(t);o+=`import { getStaticPaths as proxyGetStaticPaths } from "${c}"
/* @ts-ignore */
export const getStaticPaths = (props) => proxyGetStaticPaths({ ...props, astroI18n: `,o+=`{ locale: "${l}", route: "${u}", primaryLocale: "${r.primaryLocale}", secondaryLocales: ["${r.secondaryLocales.join('", "')}"] } })
`}let a=await this.prerender();return typeof a=="boolean"&&(o+=a?`export const prerender = true
`:`export const prerender = false
`),o+=`const { props } = Astro
---
<Page {...props} />`,o}},Je=Be;var qe=class extends Error{constructor(t){super(t?`Invalid pattern (${t.source}) given, the pattern should match the route name at index 1 (optional), the route locale at index 2 and the translated name at index 3 (optional).`:"Invalid pattern given, the pattern should match the route name at index 1 (optional), the route locale at index 2 and the translated name at index 3 (optional).")}},nn=qe;function z(e,t=!0){if(t){if(!w(e))return!1;for(let r of Object.values(e))if(!z(r,!1))return!1;return!0}if(typeof e=="string")return!0;if(!w(e))return!1;for(let r of Object.values(e))if(!z(r,!1))return!1;return!0}async function Rt(e,t={}){let{join:r}=await d.path,n=`${e}/${t.srcDir}/${D}`;if(!await N(n))throw new Qr;let o={},i=(t.secondaryLocales||[]).map(g=>`/${t.srcDir}/${D}/${g}`),s={i18n:X,pages:X,...t.translationDirectory},c=[t.primaryLocale||"en",...t.secondaryLocales||[]],a=m.fromString(`(\\/[^\\/\\s]+)?(?:\\/_?${s.pages})?\\/_?(${c.join("|")})(\\.[^\\.\\s]+)?\\.json$`),l=m.fromString(`_?${s.pages}`),u=t.showPrimaryLocale?r(n,t.primaryLocale||"en"):n;await _e(u,async(g,L)=>{if(!i.some(b=>g.includes(b)))for(let b of L){let R=`${g}/${b}`;if(await N(R))continue;let x=R.replace(n,"");if(x.endsWith(".astro")){let{match:Z,range:Ae}=tn.match(x)||{};if(!Z||!Z[2]||!Ae)continue;let ot="index",yt="/";if(Z[1]?Z[2]==="/index"?(ot=Z[1].replace("/",""),yt=`${x.slice(0,Ae[0])}/${ot}`):(ot=Z[2].replace("/",""),yt=`${x.slice(0,Ae[0]+Z[1].length)}/${ot}`):Z[2]!=="/index"&&(ot=Z[2].replace("/",""),yt=`/${ot}`),ot.startsWith("_"))continue;o[yt]={...o[yt],name:ot,route:yt,path:R};continue}if(!x.endsWith(".json"))continue;let{match:$,range:Vt}=a.match(x)||{};if(!$||!Vt)continue;let W=`${x.slice(0,Vt[0])}${$[1]||"/"}`;l.test(W)&&(W="/");let Gt=$[2]||y(),kr=W.split("/").slice(-1).join("")||"index",_r=$[3]?$[3].replace(".",""):null,be=await j(R);G(be,z,`${Gt}.PageTranslations`),k(be,o[W]?.translations?.[Gt]||{});let $o={...o[W]?.translations,[Gt]:be},jo=_r?{...o[W]?.routes,[Gt]:{[kr]:_r}}:{...o[W]?.routes};o[W]={...o[W],name:kr,route:W,translations:$o,routes:jo}}});let p=[];for(let g of Object.values(o))!g.path||!g.name||!g.route||p.push({translations:{},routes:{},...g});let h=`${e}/${t.srcDir}/${s.i18n}/${D}`;if(!await N(h))return p.map(g=>new Je(g));for(let g of p){let L=`${h}${g.route}`.replace(/\/$/,"");if(!await N(L))continue;let b=await on(L,g.name,a);for(let{translations:R,routes:x}of b)k(g.translations,R),k(g.routes,x);if(L=`${L}/${s.pages}`,!!await N(L)){b=await on(L,g.name,a);for(let{translations:R,routes:x}of b)k(g.translations,R),k(g.routes,x)}}return p.map(g=>new Je(g))}async function on(e,t,r){let{readdirSync:n}=await d.fs,o=[];for(let i of n(e,{encoding:"utf8"})){let{match:s}=r.match(`/${i}`)||{};if(!s)continue;let c=s[2]||Wr(new nn),a=s[3]?s[3].replace(".",""):null,l=await j(`${e}/${i}`);G(l,z,`${c}.PageTranslations`),o.push({translations:{[c]:l},routes:a?{[c]:{[t]:a}}:{}})}return o}var Jt=m.fromString(`${E}\\.config\\.(${Zr.join("|")})`),sn=m.fromString("astro\\.config\\.(js|cjs|mjs|ts)");var an=new m(/[/\\]?node_modules/),cn=new m(/.+?node_modules/),ln=new m(/(?:package|deno)\.json/),fn=new m(/package\.json/),un=new m(/deno\.jsonc?/),pn=new m(/deps\.ts/);var qt=".",F="common";var Ko=_.fromRegex(Jt).assertEnding().build(),mn=_.fromRegex(sn).assertEnding().build();function gn(e){let t={routes:[],extra:[],common:void 0};for(let r of Object.keys(e)){if(r.startsWith("/")){t.routes.push(r);continue}if(r===F){t.common=F;continue}t.extra.push(r)}return t}async function dn(e,t={}){let r=`${e}/${t.srcDir}/${t.translationDirectory?.i18n||X}`,n={};if(!await N(r))return n;let{readdirSync:o}=await d.fs,i=[t.primaryLocale||"en",...t.secondaryLocales||[]],s=m.fromString(`(${i.join("|")})\\.json`);for(let c of o(r)){if(c===D)continue;let a=`${r}/${c}`;if(await N(a))for(let l of o(a)){let{match:u}=s.match(l)||{};if(!u?.[1])continue;let p=u[1],h=await j(`${a}/${l}`);G(h,z,`${p}.GroupTranslations`),V(n,[c,p],h)}}return n}async function Kt(e){return xt(wn(e),Ko.regexp)}async function hn(e){let t=await xt(wn(e),mn.regexp);if(!t)return null;let{readdirSync:r}=await d.fs,n=await ft(t),o=r(n),i=o.find(a=>fn.test(a));if(i){let a=await j(`${n}/${i}`);if(Lt(a)&&Lt(a.dependencies)&&a.dependencies[E])return n}return o.find(a=>un.test(a))||o.find(a=>pn.test(a))?n:null}async function yn(e){let{readdirSync:t}=await d.fs;return typeof t(e).find(r=>mn.test(r))=="string"}function wn(e){let{match:t}=cn.match(e)||{};return t?t[0]?.replace(an.regexp,"")||"/":e}async function xt(e,t,r=1,n=!0){let{readdirSync:o}=await d.fs;if(await v(e))return t.test(e)?e:n?xt(await ft(e),t,1,!1):null;if(!await Gr(e)||Fr(e))return null;let i=o(e),s=i.find(a=>t.test(a));if(s)return`${e}/${s}`;if(r>0&&!(typeof i.find(l=>ln.test(l))=="string"))return xt(await ft(e),t,1,!1);let c=i.filter(a=>{switch(a){case"node_modules":return!1;case"src":return!1;case"public":return!1;case"dist":return!1;case"build":return!1;default:return!a.startsWith(".")}});for(let a of c){let l=`${e}/${a}`;if(await v(e))continue;let u=await xt(l,t,-1,!1);if(typeof u=="string")return u}return r>0?xt(await ft(e),t,1,!1):null}var Ke=class extends Error{constructor(){super(`Unable to find ${qr}.`)}},Tn=Ke;function Rn(e){if(!w(e))return!1;for(let t of Object.values(e)){if(!w(t))return!1;for(let r of Object.values(t))if(typeof r!="string")return!1}return!0}function xn(e){if(!w(e))return!1;for(let t of Object.values(e)){if(!w(t))return!1;for(let r of Object.values(t))if(!z(r))return!1}return!0}function bn(e){if(!ut(e))return!1;for(let t of e){if(!w(t))return!1;let r=Object.entries(t);if(r.length<2)return!1;for(let[n,o]of r)switch(n){case"groups":{if(!st(o))return!1;break}case"routes":{if(!st(o))return!1;break}default:return!1}}return!0}function An(e){if(!w(e))return!1;for(let[t,r]of Object.entries(e))if(t!=="i18n"&&t!=="pages"||typeof r!="string")return!1;return!0}function Pn(e){if(!w(e))return!1;for(let[t,r]of Object.entries(e))switch(t){case"primaryLocale":{if(typeof r!="string")return!1;break}case"secondaryLocales":{if(!st(r))return!1;break}case"fallbackLocale":{if(typeof r!="string")return!1;break}case"showPrimaryLocale":{if(typeof r!="boolean")return!1;break}case"trailingSlash":{if(r!=="always"&&r!=="never")return!1;break}case"run":{if(r!=="server"&&r!=="client+server")return!1;break}case"translations":{if(!xn(r))return!1;break}case"translationLoadingRules":{if(!bn(r))return!1;break}case"translationDirectory":{if(!An(r))return!1;break}case"routes":{if(!Rn(r))return!1;break}case"srcDir":{if(typeof r!="string")return!1;break}default:return!1}return!0}function En(e){if(!w(e))return!1;for(let[t,r]of Object.entries(e))switch(t){case"primaryLocale":{if(typeof r!="string")return!1;break}case"secondaryLocales":{if(!st(r))return!1;break}case"showPrimaryLocale":{if(typeof r!="boolean")return!1;break}case"trailingSlash":{if(r!=="always"&&r!=="never")return!1;break}default:return!1}return!0}var We=class extends Error{constructor(t){super(t?`Your primaryLocale ("${t}") cannot be contained in your secondaryLocales array.`:"Your primaryLocale cannot be contained in your secondaryLocales array.")}},Sn=We;var Ye={},vt=class{primaryLocale;secondaryLocales;fallbackLocale;showPrimaryLocale;trailingSlash;run;translations;translationLoadingRules;translationDirectory;routes;path;srcDir;constructor({primaryLocale:t,secondaryLocales:r,fallbackLocale:n,showPrimaryLocale:o,trailingSlash:i,run:s,translations:c,translationLoadingRules:a,translationDirectory:l,routes:u,srcDir:p}={},h=""){if(this.primaryLocale=t||"en",this.secondaryLocales=r||[],this.fallbackLocale=n??(t||""),this.showPrimaryLocale=o||!1,this.trailingSlash=i||"never",this.run=s||"client+server",this.translations=c||{},this.translationLoadingRules=a||[],this.translationDirectory=l||{},this.routes=u||{},this.path=h||"",this.srcDir=p||"src",this.secondaryLocales.includes(this.primaryLocale))throw new Sn(this.primaryLocale)}get pages(){return Object.keys(this.translations).filter(t=>t.startsWith("/"))}static async fromFilesystem(t=null){let{fileURLToPath:r}=await d.url;if(!t){let o="";typeof process<"u"&&(o=process.env.PWD||""),t=await Kt(await I(o))}if(!t){let o="";typeof process<"u"&&(o=process.cwd()),t=await Kt(await I(o))}if(!t){let o="";typeof Ye=="object"&&typeof Ye.url=="string"?o=r(Ye.url):typeof __filename=="string"&&(o=__filename),o&&(t=await Kt(await I(o)))}if(!t)throw new Tn;let n=t.endsWith(".json")?await j(t):(await Jr(t)).default;return G(n,Pn,"AstroI18nConfig"),new vt(n,t).loadFilesystemTranslations()}async loadFilesystemTranslations(){if(!this.path)return this;let t=await ft(this.path);if(!await yn(t)){let o=await hn(this.path);if(!o)throw new H;t=o}let r=await Rt(t,this);for(let o of r)this.translations[o.route]||(this.translations[o.route]={}),k(this.translations[o.route]||y(),o.translations),this.routes||(this.routes={}),k(this.routes,o.routes);let n=await dn(t,this);return k(this.translations,n),this}toClientSideObject(){return{primaryLocale:this.primaryLocale,secondaryLocales:this.secondaryLocales,showPrimaryLocale:this.showPrimaryLocale,trailingSlash:this.trailingSlash}}toObject(){return{primaryLocale:this.primaryLocale,secondaryLocales:this.secondaryLocales,fallbackLocale:this.fallbackLocale,showPrimaryLocale:this.showPrimaryLocale,trailingSlash:this.trailingSlash,run:this.run,translations:this.translations,translationLoadingRules:this.translationLoadingRules,translationDirectory:this.translationDirectory,routes:this.routes}}toString(){return JSON.stringify(this.toObject(),null,"	")}},bt=vt;var Nn=(n=>(n.NONE="none",n.NODE="node",n.BROWSER="browser",n))(Nn||{}),tt=Nn;var Wo=new m(/[$A-Z_a-z]/),Wt=_.fromRegex(Wo).appendPattern("[\\w$]*").build(),Ln=new m(/-?\d+(?:\.\d+)?/),On=new m(/^\s*$/),He=new m(/{{(.+)}}/),Yt=new m(/{#(.+?)#}/),vn=m.fromString(`\\(\\s*(${Wt.source})\\s*\\)`),kn=m.fromString(`>\\s*(${Wt.source})\\s*(\\()?`),_n=new m(/(?:function)?\s*[\w$]*\s*\(([\S\s]*?)\)\s*(?:=>)?\s*{?([\S\s]*)/);var Xe=class extends Error{constructor(t=""){if(t){let n=t.slice(0,20);n.length===20&&(t=`${n.slice(0,20-3)}...`)}super(t?`Cannot parse unknown value (${t}).`:"Cannot parse unknown value")}},Ht=Xe;var Ze=class extends Error{constructor(t=""){super(t?`Cannot procces untrimmed value ("${t}").`:"Cannot procces untrimmed value")}},Xt=Ze;var Zt=_.fromRegex(Ln).assertStarting().build().toMatcher(),Qt=_.fromRegex(Wt).assertStarting().build().toMatcher();function In(e){return On.test(e)?{range:[0,0],match:[""]}:null}function te(e){return e.startsWith("undefined")?{range:[0,9],match:["undefined"]}:null}function ee(e){return e.startsWith("null")?{range:[0,4],match:["null"]}:null}function re(e){return e.startsWith("true")?{range:[0,4],match:["true"]}:e.startsWith("false")?{range:[0,5],match:["false"]}:null}function ne(e){let t=e[0];if(t!=='"'&&t!=="'"&&t!=="`")return null;let r=e.slice(1).indexOf(t);return r===-1?null:(r+=2,{range:[0,r],match:[e.slice(0,r)]})}function Cn(e){if(!e.startsWith("{"))return null;let t=0;for(let r=0;r<e.length;r+=1){let n=e[r];if(n==="{"?t+=1:n==="}"&&(t-=1),t===0){let o=r+1;return{range:[0,o],match:[e.slice(0,o)]}}}return null}function oe(e){if(!e.startsWith("["))return null;let t=0;for(let r=0;r<e.length;r+=1){let n=e[r];if(n==="["?t+=1:n==="]"&&(t-=1),t===0){let o=r+1;return{range:[0,o],match:[e.slice(0,o)]}}}return null}function B(e,t){let r=0,n=!1,o=null;for(let i=0;i<e.length;i+=1){let s=e[i]||y(),c=s==='"'||s==="'"||s==="`",a=!1,l=!1;if(s==="{"||s==="["?(r+=1,a=!0):s==="}"||s==="]"?(r-=1,l=!0):!n&&c?(r+=1,n=!0,o=s,a=!0):n&&s===o&&(r-=1,n=!1,o=null,l=!0),t(s,i,r,a,l)===U)break}}var Yo=_.fromRegex(vn).assertStarting().build().toMatcher(),Ho=_.fromRegex(kn).assertStarting().build().toMatcher();function tr(e){e=e.trim();let t=e,{value:r,type:n,end:o}=Xo(e);e=e.slice(o).trim();let i=null,s=Yo(e);if(s){let{match:a,range:l}=s;i=a[1]||y(),e=e.slice(l[1]).trim()}let c=[];for(;e.length>0;){e[0]===")"&&(e=e.slice(1));let{match:a,range:l}=Ho(e)||{};if(!a?.[1]||!l)break;if(e=e.slice(l[1]).trim(),!a[2]){c.push({name:a[1],args:[]});continue}let{args:u,end:p}=Zo(e);e=e.slice(p).trim(),c.push({name:a[1],args:u})}return{raw:t,value:r,type:n,alias:i,formatters:c}}function pt(e){let t=[];e=e.trim();let{type:r,value:n,alias:o,formatters:i}=tr(e);for(let s of i)for(let c of s.args)for(let a of pt(c))t.push(a);switch(r){case 4:{t.push(o||n);break}case 6:{let s="",c=!0;B(e,(a,l,u,p)=>{if(u===0){for(let h of pt(s))t.push(h);return U}if(c){if(p&&a==="{"||/\s/.test(a))return null;if(a===":")return c=!1,null}else if(a===","){for(let h of pt(s))t.push(h);return s="",c=!0,null}return c||(s+=a),null});break}case 7:{let s="";B(e,(c,a,l,u)=>{if(l===0){for(let p of pt(s))t.push(p);return U}if(u&&c==="[")return null;if(c===","){for(let p of pt(s))t.push(p);return s="",null}return s+=c,null});break}default:break}return t}function Xo(e){if(/^\s+\S/.test(e))throw new Xt(e);let t=In(e);if(t)return{value:"undefined",type:0,end:t.range[1]};if(t=te(e),t)return{value:t.match[0]||y(),type:0,end:t.range[1]};if(t=ee(e),t)return{value:t.match[0]||y(),type:1,end:t.range[1]};if(t=re(e),t)return{value:t.match[0]||y(),type:2,end:t.range[1]};if(t=Zt(e),t)return{value:t.match[0]||y(),type:3,end:t.range[1]};if(t=Qt(e),t)return{value:t.match[0]||y(),type:4,end:t.range[1]};if(t=ne(e),t)return{value:t.match[0]||y(),type:5,end:t.range[1]};if(t=Cn(e),t)return{value:t.match[0]||y(),type:6,end:t.range[1]};if(t=oe(e),t)return{value:t.match[0]||y(),type:7,end:t.range[1]};throw new Ht(e)}function Zo(e){let t={args:[],end:0},r="",n=!1;return B(e,(o,i,s)=>(o==="("&&(n=!0),s>0?(r+=o,null):o===","?(t.args.push(r.trim()),r="",null):o===")"?(n&&(r+=o),t.args.push(r.trim()),t.end=i+1,r="",U):(r+=o,null))),t}function $n(e,t,r,n,o,i){let s;switch(r){case 0:{s=void 0;break}case 1:{s=null;break}case 2:{if(e==="true"){s=!0;break}if(e==="false"){s=!1;break}}case 3:{s=e.includes(".")?Number.parseFloat(e):Number.parseInt(e,10);break}case 4:{if(t){s=o[t];break}s=o[e];break}case 5:{s=e.slice(1,-1);break}case 6:{s=Qo(e,o,i);break}case 7:{s=ts(e,o,i);break}default:throw new Ht(e)}for(let{name:c,args:a}of n){let l=i[c];if(!l)return;let u=a.map(p=>new it(p,o,i).value);s=l(s,...u)}return s}function Qo(e,t,r){let n={},o="",i="",s=!0;return B(e,(c,a,l,u)=>{if(l===0)return n[o]=new it(i,t,r).value,U;if(l===1){if(s){if(u||/\s/.test(c))return null;if(c===":")return s=!1,null;o+=c}else if(c===",")return n[o]=new it(i,t,r).value,o="",i="",s=!0,null}return s||(i+=c),null}),n}function ts(e,t,r){let n=[],o="";return B(e,(i,s,c,a)=>{if(c===0)return n.push(new it(o,t,r).value),U;if(c===1){if(a)return null;if(i===",")return n.push(new it(o,t,r).value),o="",null}return o+=i,null}),n}var er=class{raw;value;alias=null;constructor(t,r,n){let{raw:o,value:i,type:s,alias:c,formatters:a}=tr(t);this.raw=o,this.alias=c,this.value=$n(i,c,s,a,r,n)}},it=er;var rr=class extends Error{constructor(t){super(t?`Variant priority must be of type number (found: (${t})).`:"Variant priority must be of type number.")}},jn=rr;var nr=class extends Error{constructor(t){super(t?`Invalid variant property key (${t}), it must be a valid variable name.`:"Invalid variant property value, it must be a valid variable name.")}},Dn=nr;var Fn="undefined, null, number, string, boolean and flat arrays of these types.",or=class extends Error{constructor(t){super(t?`Invalid variant property value (${t}), accepted types are: ${Fn}.`:`Invalid variant property value, accepted types are: ${Fn}.`)}},mt=or;function kt(e){if(/^\s/.test(e))throw new Xt(e);let t=te(e);if(t)return{value:t.match[0]||y(),type:0,end:t.range[1]};if(t=ee(e),t)return{value:t.match[0]||y(),type:1,end:t.range[1]};if(t=re(e),t)return{value:t.match[0]||y(),type:2,end:t.range[1]};if(t=Zt(e),t)return{value:t.match[0]||y(),type:3,end:t.range[1]};if(t=ne(e),t)return{value:t.match[0]||y(),type:5,end:t.range[1]};if(t=oe(e),t)return{value:t.match[0]||y(),type:7,end:t.range[1]};throw new mt(e)}function sr(e){return e===null||typeof e>"u"||typeof e=="boolean"||typeof e=="number"||typeof e=="string"}function Mn(e){return Array.isArray(e)?e.every(t=>sr(t)):!1}function _t(e,t){let r;switch(t){case 0:{r=void 0;break}case 1:{r=null;break}case 2:{if(e==="true"){r=!0;break}if(e==="false"){r=!1;break}}case 3:{r=e.includes(".")?Number.parseFloat(e):Number.parseInt(e,10);break}case 5:{r=e.slice(1,-1);break}case 7:{r=es(e);break}default:throw new mt(e)}return r}function es(e){let t=[],r="";return B(e,(n,o,i,s)=>{if(i===0){let{value:c,type:a}=kt(r.trim()),l=_t(c,a);if(!sr(l))throw new mt(r);return t.push(l),U}if(i===1){if(s)return null;if(n===","){let{value:c,type:a}=kt(r.trim());return t.push(_t(c,a)),r="",null}}return r+=n,null}),t}var se="$priority";var It=class{raw;priority;properties;value;constructor({raw:t,priority:r,properties:n,value:o}={}){this.raw=t||"",this.priority=r||0,this.properties=n||[],this.value=o||""}static fromString(t,r){let n=new It;n.value=r;let o=t.trim();n.raw=o;let i="",s="",c=!0;return B(o,(a,l,u)=>{let p=l===o.length-1;if(c)return/\s/.test(a)?null:a===":"?(c=!1,null):(i+=a,null);if(u>0)return s+=a,null;if(p&&(s+=a),a===","||p){let h=Qt(i.trim())?.match[0];if(!h)throw new Dn(i);let{value:g,type:L}=kt(s.trim());if(h===se){let x=_t(g,L);if(typeof x!="number")throw new jn(g);return n.priority=x*.001,null}let b=_t(g,L),R=Array.isArray(b)?b:[b];if(!Mn(R))throw new mt(s);return n.properties.push({name:h,values:R}),i="",s="",c=!0,null}return s+=a,null}),n}calculateMatchingScore(t){let r=0;for(let{name:n,values:o}of this.properties){if(!Object.hasOwn(t,n))continue;let i=t[n],s=[];for(let c of o){if(typeof i=="number"&&typeof c=="number"){let a=i-c;if(a===0){s.push(1e3);continue}s.push(Math.abs(1e3/a)-1);continue}i===c&&s.push(1e3)}s.length!==0&&(r+=Math.max(...s))}return r>0?r+this.priority:r}},ie=It;var ir=class extends Error{constructor(){super("Cannot use a variant on a key which value is not a string.")}},Vn=ir;function ar(e,t="",r={}){for(let[n,o]of Object.entries(e)){if(typeof o=="string"){let{match:i,range:s}=He.match(n)||{};if(!i?.[1]||!s){let a=`${t}${qt}${n}`.replace(/^\./,"");if(r[a]){r[a].default=o;continue}r[a]={default:o,variants:[]};continue}let c=`${t}${qt}${n.slice(0,s[0])+n.slice(s[1])}`.replace(/^\./,"");if(r[c]){r[c].variants.push(ie.fromString(i[1],o));continue}r[c]={variants:[ie.fromString(i[1],o)]};continue}if(He.test(n))throw new Vn;ar(o,`${t}${qt}${n}`.replace(/^\./,""),r)}return r}function Gn(e,t,r){let n=[];Yt.exec(e,({match:i,range:s})=>{if(!i[1])return;let{value:c}=new it(i[1],t,r);n.push({value:rs(c),range:s})});let o=e;for(let i=n.length-1;i>=0;i-=1){let{value:s,range:c}=n[i]||y();o=o.slice(0,c[0])+s+o.slice(c[1])}return o}function rs(e){switch(typeof e){case"undefined":return"";case"string":return e;case"bigint":return e.toString();case"number":return e.toString();case"boolean":return e.toString();case"symbol":return`Symbol(${e.description})`||"Symbol";case"function":return e.name;case"object":return e?Object.hasOwn(e,"toString")&&typeof e.toString=="function"?e.toString():JSON.stringify(e,null,"	"):"";default:return""}}function Un(e){for(let t of Object.values(e))for(let r of Object.values(t))for(let n of Object.values(r))n.variants=n.variants.map(o=>new ie(o));return e}var gt=new m(/\[(\.{3})?([\w-]+)]/),zn=new m(/(?:https?:\/{2})?[\w#%+.:=@~-]{1,256}\.[\d()A-Za-z]{1,6}\b[\w#%&()+./:=?@~-]*/);var Ct=class{#e={};#t;constructor(t={},r={}){this.#t=t,this.#e=r}static fromConfig({translations:t,translationLoadingRules:r}){return new Ct().addTranslations(t).addTranslationLoadingRules(r)}get(t,r,n,o="",i={},s={},c=!1){let a=this.#r(t,r,n,c);!a&&o&&o!==n&&(a=this.#r(t,r,o,c));let l={score:0,value:a?.default||t};for(let u of a?.variants||[]){let p=u.calculateMatchingScore(i);p>l.score&&(l.score=p,l.value=u.value)}return Gn(l.value,i,s)}getRouteGroups(){return Object.keys(this.#t).filter(t=>t.startsWith("/"))}getParamRouteGroups(){return Object.keys(this.#t).filter(t=>t.startsWith("/")&&gt.test(t))}getLocaleTranslationVariables(t){let r={};for(let n of Object.values(this.#t)){if(!n[t])continue;let o=Object.entries(n[t]||y());for(let[i,{default:s,variants:c}]of o){let a={interpolationVars:[],variantVars:[],isVariantRequired:!1},l=[];if(s===void 0?a.isVariantRequired=!0:l.push(s),c.length>0){let b={};for(let{value:R,properties:x}of c){l.push(R);for(let{name:$,values:Vt}of x)b[$]=[...b[$]||[],...Vt]}a.variantVars=Object.entries(b).map(([R,x])=>({name:R,values:x}))}for(let b of l)Yt.exec(b,({match:R})=>{R[1]&&(a.interpolationVars=[...new Set([...a.interpolationVars,...pt(R[1])])])});if(!r[i]){r[i]=a;continue}let{interpolationVars:u,variantVars:p,isVariantRequired:h}=r[i]||{},g=[...new Set([...u||[],...a.interpolationVars])],L=[];for(let b of a.variantVars){let R=p?.find(x=>x.name===b.name);L.push(R?{name:b.name,values:[...new Set([...R?.values||[],...b.values])]}:b)}r[i]={interpolationVars:g,variantVars:L,isVariantRequired:(h||!1)&&a.isVariantRequired}}}return r}addTranslations(t){for(let[r,n]of Object.entries(t)){let o=Object.entries(n);if(o.length===0&&!this.#t[r]){this.#t[r]={};continue}for(let[i,s]of o)V(this.#t,[r,i],ar(s))}return this}addTranslationLoadingRules(t){if(t.length===0)return this;let{routes:r}=gn(this.#t);for(let n of t){let o=[];for(let i of n.groups){let s=m.fromString(i);o.push(...Object.keys(this.#t).filter(c=>s.test(c)))}for(let i of n.routes){let s=m.fromString(i),c=r.filter(a=>s.test(a));for(let a of c){if(!this.#e[a]){this.#e[a]=[...new Set(o)];continue}this.#e[a]=[...new Set([...this.#e[a]||y(),...o])]}}}return this}clear(){this.#e={},this.#t={}}toClientSideObject(t){let r={};if(this.#e[t])for(let n of this.#e[t]||y())r[n]=this.#t[n]||{};return this.#t[t]&&(r[t]=this.#t[t]||{}),this.#t[F]&&(r[F]=this.#t[F]||{}),r}toObject(){return{loadDirectives:this.#e,translations:this.#t}}toString(){return JSON.stringify(this.toObject(),null,"	")}#r(t,r,n,o=!1){let i=null;if(o){let s=this.getRouteGroups();for(let c of s)for(let a of this.#e[c]||[]){let l=this.#t[a]?.[n]?.[t];if(l){i=l;break}}if(!i)for(let c of s)this.#t[c]?.[n]?.[t]&&(i=this.#t[c]?.[n]?.[t]||y())}else{for(let s of this.#e[r]||[]){let c=this.#t[s]?.[n]?.[t];if(c){i=c;break}}!i&&this.#t[r]?.[n]?.[t]&&(i=this.#t[r]?.[n]?.[t]||y())}return!i&&this.#t[F]?.[n]?.[t]&&(i=this.#t[F]?.[n]?.[t]||y()),i}},ae=Ct;var cr=class extends Error{constructor(t){super(t?`Invalid date (${t}).`:"Invalid date.")}},Bn=cr;var lr=class extends TypeError{constructor(t,r){t?super(r?`Invalid formatter (${r}) parameter: ${t}`:`Invalid formatter parameter: ${t}`):super(r?`Invalid formatter (${r}) parameter.`:"Invalid formatter parameter.")}},At=lr;var fr=class extends TypeError{constructor(t,r){t?super(r?`Invalid formatter (${r}) value: ${t}`:`Invalid formatter value: ${t}`):super(r?`Invalid formatter (${r}) value.`:"Invalid formatter value.")}},dt=fr;function ur(e){if(typeof e!="string")throw new dt(`Received value is not a string, found "${e}".`,"upper");return e.toUpperCase()}function pr(e){if(typeof e!="string")throw new dt(`Received value is not a string, found "${e}".`,"lower");return e.toLowerCase()}function Jn(e){if(typeof e!="string")throw new dt(`Received value is not a string, found "${e}".`,"capitalize");return`${e.slice(0,1).toUpperCase()}${e.slice(1).toLowerCase()}`}function qn(e,t){return e??t}function mr(e,t){return e||t}function Kn(e,t){return typeof e=="string"?e:t}function Wn(e,t=!0){if(typeof e=="symbol")throw new dt(`Received value cannot be a symbol, found "${e.toString()}".`,"json");if(typeof t!="boolean")throw new At(`format must be a boolean, found "${t}".`,"json");return t?JSON.stringify(e,null,"	"):JSON.stringify(e)}function Yn(e,t={},r=S.locale){if(typeof e=="string"&&(e=Number.parseFloat(e)),!Yr(e))throw new dt(`Received value is not a number, found "${e}".`,"intl_format_number");if(!w(t))throw new At(`options must be an object, found "${t}".`,"intl_format_number");if(typeof r!="string")throw new At(`locale must be a string, found "${r}".`,"intl_format_number");return new Intl.NumberFormat(r,t).format(e)}function Hn(e,t={},r=S.locale){if(typeof e!="string"&&typeof e!="number"&&!(e instanceof Date))throw new dt(`Received value is not a string, number or Date, found "${e}".`,"intl_format_date");if(e=e instanceof Date?e:new Date(e),!Hr(e))throw new Bn(e);if(!w(t))throw new At(`options must be an object, found "${t}".`,"intl_format_date");if(typeof r!="string")throw new At(`locale must be a string, found "${r}".`,"intl_format_date");return new Intl.DateTimeFormat(r,t)}var ns=_.fromRegex(_n).assertStarting().assertEnding().build().toMatcher();function Xn(e){let t=ns(e.toString());if(!t)return{args:[],body:""};let[,r,n]=t.match;return{args:os(r||""),body:ss(n||"")}}function Zn(e){let t={};for(let[r,n]of Object.entries(e))t[r]=new Function(...n.args,n.body);return t}function os(e){return e.trim().split(",").map(t=>t.trim())}function ss(e){return e.trim().endsWith("}")?e.slice(0,-1):e}var gr=class{#e={upper:ur,uppercase:ur,lower:pr,lowercase:pr,capitalize:Jn,json:Wn,default_nullish:qn,default:mr,default_falsy:mr,default_non_string:Kn,intl_format_number:Yn,intl_format_date:Hn};#t;#r;constructor(t={}){this.#t=t,this.#r={...this.#e,...this.#t}}get default(){return this.#e}get custom(){return this.#t}addFormaters(t){for(let[r,n]of Object.entries(t))this.#r[r]||(this.#r[r]=n,this.#t[r]=n);return this}clear(){this.#t={},this.#r={}}toClientSideObject(){let t={};for(let[r,n]of Object.entries(this.#t))t[r]=Xn(n);return t}toObject(){return this.#r}toString(){return JSON.stringify(this.toObject(),null,"	")}},ce=gr;var dr=class extends Error{constructor(t){super(t?`Invalid environment: ${t}`:"Invalid environment.")}},Qn=dr;var $t=class{#e;#t;constructor(t={},r=""){this.#t=t,this.#e=r}static fromConfig({routes:t,primaryLocale:r}){return new $t({},r).addSegments(t)}get(t,r,n){return this.#t[r]?.[t]?.[n]||null}getSegmentLocales(t){let r=[];for(let[n,o]of Object.entries(this.#t))o[t]&&r.push(n);return r}addSegments(t){let r=Object.entries(t);for(let[n,o]of r){let i=r.filter(([s])=>s!==n&&s!==this.#e);for(let[s,c]of Object.entries(o)){V(this.#t,[this.#e,s,n],c),V(this.#t,[n,c,this.#e],s);for(let[a,l]of i)l[s]&&V(this.#t,[n,c,a],l[s])}}return this}clear(){this.#e="",this.#t={}}toClientSideObject(){return{...this.#t}}toObject(){return{primaryLocale:this.#e,segments:this.#t}}toString(){return JSON.stringify(this.toObject(),null,"	")}},le=$t;var hr=class extends Error{constructor(){super("Cannot initialize astro-i18n, it already has been initialized.")}},to=hr;var yr=class extends Error{constructor(t){super(t?`Cannot use filesystem: ${t}`:"Cannot use filesystem.")}},eo=yr;var wr=class extends Error{constructor(){super(`Could not find the serialized ${E} state in the DOM. Check your ${E} config.`)}},ro=wr;function no(e){if(!w(e))return!1;for(let t of Object.values(e)){if(!w(t))return!1;for(let r of Object.values(t)){if(!w(r))return!1;for(let n of Object.values(r))if(typeof n!="string")return!1}}return!0}function oo(e){if(!w(e))return!1;for(let t of Object.values(e)){if(!w(t))return!1;let r=Object.entries(t);if(r.length<2)return!1;for(let[n,o]of r)switch(n){case"args":{if(!st(o))return!1;break}case"body":{if(typeof o!="string")return!1;break}default:break}}return!0}function so(e){if(!w(e))return!1;for(let t of Object.values(e)){if(!w(t))return!1;for(let r of Object.values(t))if(!is(r))return!1}return!0}function is(e){if(!w(e))return!1;for(let t of Object.values(e)){if(!w(t))return!1;for(let[r,n]of Object.entries(t))switch(r){case"default":{if(typeof n!="string")return!1;break}case"variants":{if(!ut(n)||!n.every(o=>as(o)))return!1;break}default:return!1}}return!0}function as(e){if(!w(e))return!1;let t=Object.entries(e);if(t.length<4)return!1;for(let[r,n]of t)switch(r){case"raw":{if(typeof n!="string")return!1;break}case"priority":{if(typeof n!="number")return!1;break}case"properties":{if(!ut(n)||!n.every(o=>cs(o)))return!1;break}case"value":{if(typeof n!="string")return!1;break}default:return!1}return!0}function cs(e){if(!w(e))return!1;let t=Object.entries(e);if(t.length<2)return!1;for(let[r,n]of t)switch(r){case"name":{if(typeof n!="string")return!1;break}case"values":{if(!ut(n)||!n.every(o=>typeof o=="boolean"||typeof o=="string"||typeof o=="number"||o==null))return!1;break}default:return!1}return!0}function io(e){if(!w(e))return!1;let t=Object.entries(e);if(t.length<5)return!1;for(let[r,n]of t)switch(r){case"locale":{if(typeof n!="string")return!1;break}case"route":{if(typeof n!="string")return!1;break}case"config":{if(!En(n))return!1;break}case"translations":{if(!so(n))return!1;break}case"segments":{if(!no(n))return!1;break}case"formatters":{if(!oo(n))return!1;break}default:return!1}return!0}function ao(e){let t=[];return gt.exec(e,({match:r})=>{r[2]&&t.push(r[2])}),t}function Tr(e){return zn.test(e)}function co(e){let t="",r=0;return gt.exec(e,({match:n,range:[o,i]})=>{if(t+=e.slice(r,o),!n[2]){r=i;return}t+=n[1]?"[\\w/-]+":"[\\w-]+",r=i}),t+=e.slice(r),m.fromString(t.replaceAll("/","\\/"))}var Rr=class extends Error{constructor(){super("Cannot perform operation, astro-i18n is not initialized.")}},xr=Rr;var br=class extends Error{constructor(){super("Could not redirect, is this code running in the server ?")}},lo=br;var jt,at,et,rt,O,C,M,J,q,nt,ct,K,ht,me,fo,ge,uo,de,po,he,mo,ye,go,Pt,ue,Dt,Ar,Ft,Pr,Et,pe,Mt,Er,we,ho,Te,yo,Re=class{constructor(){T(this,me);T(this,ge);T(this,de);T(this,he);T(this,ye);T(this,Pt);T(this,Dt);T(this,Ft);T(this,Et);T(this,Mt);T(this,we);T(this,Te);T(this,at,void 0);T(this,et,"");T(this,rt,"");T(this,O,new bt);T(this,C,new ae);T(this,M,new le);T(this,J,new ce);T(this,q,!1);T(this,nt,!1);T(this,ct,{});T(this,K,null);T(this,ht,"");typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node<"u"?A(this,at,tt.NODE):typeof window>"u"?A(this,at,tt.NONE):(A(this,at,tt.BROWSER),f(this,O).run==="client+server"&&P(this,me,fo).call(this))}get environment(){return f(this,at).toString()}get route(){return f(this,nt)?"":f(this,rt)}set route(t){Tr(t)&&(t=new URL(t).pathname),t=decodeURI(t);let{locale:r,route:n}=P(this,Et,pe).call(this,t);A(this,rt,n),A(this,et,r||P(this,Ft,Pr).call(this,P(this,Mt,Er).call(this,n))||this.primaryLocale)}get pages(){return f(this,C).getRouteGroups()}get page(){return P(this,Pt,ue).call(this,this.route)}get locale(){return f(this,et)}get locales(){return[f(this,O).primaryLocale,...f(this,O).secondaryLocales]}get primaryLocale(){return f(this,O).primaryLocale}get secondaryLocales(){return f(this,O).secondaryLocales}get fallbackLocale(){return f(this,O).fallbackLocale}get isInitialized(){return f(this,q)}get internals(){return{toHtml:P(this,we,ho).bind(this),config:f(this,O),segments:f(this,M),translations:f(this,C),splitLocaleAndRoute:P(this,Et,pe).bind(this),toString:P(this,Te,yo).bind(this),waitInitialization:P(this,ge,uo).bind(this),setPrivateProperties:P(this,ye,go).bind(this),reinitalize:P(this,de,po).bind(this),getAndClearRedirection:P(this,he,mo).bind(this)}}t(t,r={},n={}){if(!f(this,q))throw new xr;let{route:o,locale:i,fallbackLocale:s}=n;if(f(this,nt))return f(this,C).get(t,"",i||this.locale,s||this.fallbackLocale,r,f(this,J).toObject(),!0);let c=o?P(this,Pt,ue).call(this,o):P(this,Pt,ue).call(this,this.route);return f(this,C).get(t,c||"",i||this.locale,s||this.fallbackLocale,r,f(this,J).toObject())}l(t,r={},n={}){if(!f(this,q))throw new xr;let{targetLocale:o,routeLocale:i,showPrimaryLocale:s,query:c}=n,a=P(this,Mt,Er).call(this,decodeURI(t)),l=this.locales.includes(a[0]||"")&&a.shift()||"",u=i||l||P(this,Ft,Pr).call(this,a)||this.primaryLocale,p=o||this.locale,h=a.map(x=>f(this,M).get(x,u,p)||x).join("/"),g=Object.entries(r);if(g.length>0)for(let[x,$]of g)h=h.replace(`[${x}]`,String($).replace("/",""));if((s===void 0?f(this,O).showPrimaryLocale||p!==this.primaryLocale:s)&&(h=h?`${p}/${h}`:p),f(this,O).trailingSlash==="always"&&(h+="/"),h=h.startsWith("/")?h:`/${h}`,!c)return h;let b={};for(let[x,$]of Object.entries(c))b[x]=String($);let R=new URLSearchParams(b).toString();return R?`${h}?${R}`:h}addTranslations(t){return f(this,C).addTranslations(t),P(this,Dt,Ar).call(this),this}addFormatters(t){return f(this,J).addFormaters(t),this}addTranslationLoadingRules(t){return f(this,C).addTranslationLoadingRules(t),this}addRoutes(t){return f(this,M).addSegments(t),P(this,Dt,Ar).call(this),this}extractRouteLocale(t){return P(this,Et,pe).call(this,t).locale}redirect(t,r=301){if(this.environment===tt.BROWSER)throw new lo;if(typeof t=="string"){let n=Tr(t)?new URL(t):new URL(`${f(this,ht)}/${t.replace(/^\//,"")}`);A(this,K,Response.redirect(n,r));return}A(this,K,Response.redirect(t,r))}async initialize(t=void 0,r={}){if(f(this,q))throw new to;switch(f(this,at)){case tt.NODE:{A(this,O,typeof t=="object"?await new bt(t).loadFilesystemTranslations():await bt.fromFilesystem(t));break}case tt.NONE:{if(typeof t=="string")throw new eo("Cannot load config from filesystem in a non-node environment.");A(this,O,new bt(t||{}));break}default:throw new Qn("Cannot initialize in a browser environment.")}A(this,C,ae.fromConfig(f(this,O))),A(this,M,le.fromConfig(f(this,O))),A(this,J,new ce(r)),A(this,q,!0)}},fe=Re;jt=new WeakMap,at=new WeakMap,et=new WeakMap,rt=new WeakMap,O=new WeakMap,C=new WeakMap,M=new WeakMap,J=new WeakMap,q=new WeakMap,nt=new WeakMap,ct=new WeakMap,K=new WeakMap,ht=new WeakMap,me=new WeakSet,fo=function(){let t=document.querySelector(`#${f(Re,jt)}`);if(!t||!t.textContent)throw new ro;let r=JSON.parse(t.textContent);G(r,io),A(this,et,r.locale),A(this,rt,r.route),A(this,O,new bt(r.config)),A(this,C,new ae(Un(r.translations))),A(this,M,new le(r.segments,r.config.primaryLocale)),A(this,J,new ce(Zn(r.formatters))),A(this,q,!0),t.remove()},ge=new WeakSet,uo=async function(){let t=r=>{f(this,q)?r():setTimeout(()=>t(r),25)};return new Promise(t)},de=new WeakSet,po=async function(t=void 0,r={}){A(this,q,!1),f(this,C).clear(),f(this,M).clear(),f(this,J).clear(),await this.initialize(t,r)},he=new WeakSet,mo=function(){let t=f(this,K);return A(this,K,null),t},ye=new WeakSet,go=function(t={}){let{route:r,locale:n,isGetStaticPaths:o,origin:i}={route:f(this,rt),locale:f(this,et),isGetStaticPaths:f(this,nt),origin:f(this,ht),...t};A(this,rt,r),A(this,et,n),A(this,nt,o),A(this,ht,i)},Pt=new WeakSet,ue=function(t){if(f(this,nt))return null;if(f(this,ct)[t])return f(this,ct)[t]||y();let r=this.l(t,void 0,{targetLocale:this.primaryLocale});if(this.pages.includes(r))return r;let n=null;for(let o of this.pages)if(gt.test(o)&&co(o).test(t)){n=o;break}return!n||!this.pages.includes(n)?null:(f(this,ct)[t]=n,n)},Dt=new WeakSet,Ar=function(){A(this,ct,{})},Ft=new WeakSet,Pr=function(t){let r={};for(let o of t)for(let i of f(this,M).getSegmentLocales(o))r[i]||(r[i]=0),r[i]+=1;let n={locale:"",score:0,isExAequo:!0};for(let[o,i]of Object.entries(r)){if(i>n.score){n.locale=o,n.score=i,n.isExAequo=!1;continue}i===n.score&&(n.isExAequo=!0)}return n.isExAequo?null:n.locale||null},Et=new WeakSet,pe=function(t){t.startsWith("/")||(t=`/${t}`);let r=m.fromString(`\\/(${this.locales.join("|")})(?:\\/.*)?$`),{match:n}=r.match(t)||{},o=n?.[1]||null;return{locale:o,route:o?t.replace(`/${o}`,"").replace(/\/$/,"")||"/":t.replace(/\/$/,"")||"/"}},Mt=new WeakSet,Er=function(t){return t.replace(/^\//,"").replace(/\/$/,"").split("/")},we=new WeakSet,ho=function(){let t={locale:f(this,et),route:f(this,rt),config:f(this,O).toClientSideObject(),translations:f(this,C).toClientSideObject(this.route),segments:f(this,M).toClientSideObject(),formatters:f(this,J).toClientSideObject()};return`<script id="${f(Re,jt)}" type="application/json">${JSON.stringify(t)}</script>`},Te=new WeakSet,yo=function(){let t={};for(let[r,n]of Object.entries(f(this,J).toObject()))t[r]=n.name;return JSON.stringify({environment:this.environment,route:this.route,locale:this.locale,locales:this.locales,primaryLocale:this.primaryLocale,secondaryLocales:this.secondaryLocales,fallbackLocale:this.fallbackLocale,isInitialized:this.isInitialized,"#redirection":f(this,K)instanceof Response?{url:f(this,K).url,status:f(this,K).status}:f(this,K),"#origin":f(this,ht),"#isGetStaticPaths":f(this,nt),"#routePageCache":f(this,ct),"#config":f(this,O).toObject(),"#translations":f(this,C).toObject(),"#segments":f(this,M).toObject(),"#formatters":t},null,"	")},T(fe,jt,`__${E}__`);var wo=fe;var S=new wo;var To={name:"generate:pages",options:["purge","root"]};async function Ro({command:e,options:t}){if(e!==To.name)throw new Y;let{join:r}=await d.path,n=await I(typeof t.root=="string"?t.root:process.cwd());if(!await N(n))throw new H;await S.initialize();let o=r(n,`${S.internals.config.srcDir}/${D}`);if(t.purge)for(let s of S.secondaryLocales){let c=r(o,s);N(c)&&await Ur(c)}let i=await Rt(n,S.internals.config);for(let s of i)if(s.route!=="/404")for(let c of S.secondaryLocales){let a=S.l(s.route,void 0,{targetLocale:c}),l=await s.getProxy(a,S);l&&await Q(r(o,a,"index.astro"),l)}}var Sr=To;var xo=m.fromString(`\\/{2}\\s+###>\\s+${E}\\/type-generation\\s+###\\n([\\s\\S]*)\\/{2}\\s+###<\\s+${E}\\/type-generation ###`),bo=new m(/t\s*\(\s*["'`](#[^#]+#)?([\S\s]*?)["'`]\s*[),]/g),Ao=new m(/middleware\.(?:ts|js|cjs|mjs)$/),Po=new m(/index\.(?:ts|js|cjs|mjs)$/);var Eo={name:"generate:types",options:["root"]};async function So({command:e,options:t}){if(e!==Eo.name)throw new Y;let{join:r}=await d.path,{readFileSync:n,appendFileSync:o,writeFileSync:i}=await d.fs,s=await I(typeof t.root=="string"?t.root:process.cwd());if(!await N(s))throw new H;await S.initialize();let c=S.internals.translations.getLocaleTranslationVariables(S.primaryLocale),a=S.internals.translations.getRouteGroups(),l=`type PrimaryLocale = "${S.primaryLocale}"
`;l+=`type SecondaryLocale = "${S.secondaryLocales.join('"|"')}"
`,l+=`type Locale = PrimaryLocale | SecondaryLocale
`,l+=`${ls("RouteParameters",a)}
`,l+=`type Route = keyof RouteParameters
`,l+=`${fs("TranslationVariables",c)}
`,l+=`type Translation = keyof TranslationVariables
`,l+=`type Environment = "${Object.values(tt).join('"|"')}"
`,l+=`
declare module "${E}" {
	type GetStaticPathsProps = {paginate:Function;rss:Function}
	type GetStaticPathsItem = {params:Record<string,number|string|undefined>;props?:Record<string,unknown>}
	type DeepStringRecord = {[key: string]:string|DeepStringRecord}
	type TranslationDirectory = {i18n?:string;pages?: string}
	export type Translations = {[group: string]:{[locale: string]: DeepStringRecord}}
	export type TranslationFormatters = {[formatterName: string]:(value:unknown,...args:unknown[])=>unknown}
	export type TranslationLoadingRules = {groups:string[];routes: string[]}[]
	export type SegmentTranslations = {[secondaryLocale: string]:{[segment: string]:string}}
	export interface AstroI18nConfig {primaryLocale:string;secondaryLocales:string[];fallbackLocale:string;showPrimaryLocale:boolean;trailingSlash:"always"|"never";run:"server"|"client+server";translations:Translations;translationLoadingRules:TranslationLoadingRules;translationDirectory:TranslationDirectory;routes:SegmentTranslations;srcDir:string;}
	/** Typed astro-i18n config definition. */
	export function defineAstroI18nConfig(config: Partial<AstroI18nConfig>): Partial<AstroI18nConfig>
	/** The \`${E}\` middleware. */
	export function useAstroI18n(
		config?: Partial<AstroI18nConfig> | string,
		formatters?: TranslationFormatters,
	): (...args: any[]) => any
	/** Workaround function to make astroI18n work inside getStaticPaths. This is because Astro's getStaticPaths runs before everything which doesn't allows astroI18n to update its state automatically. */
	function createGetStaticPaths(
		callback: (
			props: GetStaticPathsProps,
		) => GetStaticPathsItem[] | Promise<GetStaticPathsItem[]>,
	): (props: GetStaticPathsProps & {
		astroI18n?: {
			locale: string;
		};
	}) => Promise<GetStaticPathsItem[]>
	/**
	 * @param key The translation key, for example \`"my.nested.translation.key"\`.
	 * @param properties An object containing your interpolation variables and/or your variants, for example \`{ variant: 3, interpolation: "text" }\`.
	 * @param options \`route\`: Overrides the current route, you will be able to access that route's translations. \`locale\`: Overrides the current locale, this allows you to control which language you want to translate to. \`fallbackLocale\`: Overrides the fallback locale.
	 */
	export function t<T extends Translation>(
		key: T | string & {},
		...args: undefined extends TranslationVariables[T]
			? [
				properties?: keyof TranslationVariables extends T 
					? Record<string, unknown> 
					: TranslationVariables[T], 
				options?: {
					route?: Route | string & {}
					locale?: Locale | string & {}
					fallbackLocale?: Locale | string & {}
				}
			]
			: [
				properties: TranslationVariables[T], 
				options?: {
					route?: Route | string & {}
					locale?: Locale | string & {}
					fallbackLocale?: Locale | string & {}
				}
			]
	): string
	/**
	 * @param route A route in any of the configured languages, for example \`"/en/my/english/route/[param]"\`.
	 * @param parameters An object containing your route parameters, for example \`{ slug: "my-blog-post-slug" }\`.
	 * @param options \`targetLocale\`: Overrides the target locale. \`routeLocale\`: Overrides the given route locale, this is useful if ${E} cannot figure out the route's locale. \`showPrimaryLocale\`: Overrides the showPrimaryLocale parameter. \`query\`: Adds these query parameters at the end of the translated route.
	 */
	export function l<T extends Route>(
		route: T | string & {},
		...args: T extends keyof RouteParameters
			? undefined extends RouteParameters[T]
				? [
					parameters?: Record<string, string>, 
					options?: { 
						targetLocale?: string, 
						routeLocale?: string,
						showPrimaryLocale?: string,
						query?: Record<string, unknown>
					}
				]
				: [
					parameters: RouteParameters[T], 
					options?: { 
						targetLocale?: string, 
						routeLocale?: string,
						showPrimaryLocale?: string,
						query?: Record<string, unknown>
					}
				]
			: [
				parameters?: Record<string, string>, 
				options?: { 
					targetLocale?: string, 
					routeLocale?: string,
					showPrimaryLocale?: string,
					query?: Record<string, unknown>
				}
			]
	): string
	class AstroI18n {
		/** The detected runtime environment. */
		environment: Environment
		/** The current page route. */
		route: string
		/** All page routes. For example: \`["/", "/about", "/posts/[slug]"]\` */
		pages: string[]
		/** The equivalent page for the current route. For example if route is equal to \`"/posts/my-cool-cat"\` this could return \`"/posts/[slug]"\`. */
		page: string
		/** The current page locale. */
		locale: Locale
		/** All configured locales. */
		locales: Locale[]
		/** The default/primary locale. */
		primaryLocale: PrimaryLocale
		/** Locales other than the default/primary one. */
		secondaryLocales: SecondaryLocale[]
		/** The fallback locale, when a translation is missing in a locale the fallback locale will be used to find a replacement. */
		fallbackLocale: Locale
		/** True when ${E} is initialized. */
		isInitialized: boolean
		/**
		 * @param key The translation key, for example \`"my.nested.translation.key"\`.
		 * @param properties An object containing your interpolation variables and/or your variants, for example \`{ variant: 3, interpolation: "text" }\`.
		 * @param options \`route\`: Overrides the current route, you will be able to access that route's translations. \`locale\`: Overrides the current locale, this allows you to control which language you want to translate to. \`fallbackLocale\`: Overrides the fallback locale.
		 */
		t<T extends Translation>(
			key: T | string & {},
			...args: undefined extends TranslationVariables[T]
				? [
					properties?: keyof TranslationVariables extends T 
						? Record<string, unknown> 
						: TranslationVariables[T], 
					options?: {
						route?: Route | string & {}
						locale?: Locale | string & {}
						fallbackLocale?: Locale | string & {}
					}
				]
				: [
					properties: TranslationVariables[T], 
					options?: {
						route?: Route | string & {}
						locale?: Locale | string & {}
						fallbackLocale?: Locale | string & {}
					}
				]
		): string
		/**
		 * @param route A route in any of the configured languages, for example \`"/en/my/english/route/[param]"\`.
		 * @param parameters An object containing your route parameters, for example \`{ slug: "my-blog-post-slug" }\`.
		 * @param options \`targetLocale\`: Overrides the target locale. \`routeLocale\`: Overrides the given route locale, this is useful if ${E} cannot figure out the route's locale. \`showPrimaryLocale\`: Overrides the showPrimaryLocale parameter. \`query\`: Adds these query parameters at the end of the translated route.
		 */
		l<T extends Route>(
			route: T | string & {},
			...args: T extends keyof RouteParameters
				? undefined extends RouteParameters[T]
					? [
						parameters?: Record<string, string>, 
						options?: { 
							targetLocale?: string, 
							routeLocale?: string,
							showPrimaryLocale?: string,
							query?: Record<string, unknown>
						}
					]
					: [
						parameters: RouteParameters[T], 
						options?: { 
							targetLocale?: string, 
							routeLocale?: string,
							showPrimaryLocale?: string,
							query?: Record<string, unknown>
						}
					]
				: [
					parameters?: Record<string, string>, 
					options?: { 
						targetLocale?: string, 
						routeLocale?: string,
						showPrimaryLocale?: string,
						query?: Record<string, unknown>
					}
				]
		): string
		/** Adds new translations at runtime. */
		addTranslations(translations: Translations): this
		/** Adds new translation formatters at runtime. */
		addFormatters(translationFormatters: TranslationFormatters): this
		/** Adds new translation loading rules at runtime. */
		addTranslationLoadingRules(translationLoadingRules: TranslationLoadingRules): this
		/** Adds new route segment translations at runtime. */
		addRoutes(routes: SegmentTranslations): this
		/** Tries to parse one of the configured locales out of the given route. If no configured locale is found it will return \`null\`. */
		extractRouteLocale(route: string): string|null
		/** Initializes ${E} on the server-side. */
		initialize(config?: Partial<AstroI18nConfig> | string, formatters?: TranslationFormatters = {}): Promise<void>
		/** Redirects the user to the given destination. */
		redirect(destination: string | URL, status = 301)
	}
	export const astroI18n: AstroI18n
}`.trim();let u=r(s,S.internals.config.srcDir,"env.d.ts");if(await v(u)){let p=n(u,{encoding:"utf8"}),{match:h,range:g}=xo.match(p)||{};h&&g?i(u,p.slice(0,g[0])+Nr(l)+p.slice(g[1])):o(u,`

${Nr(l)}
`);return}i(u,`/// <reference types="astro/client" />

${Nr(l)}
`)}function Nr(e){return`// ###> astro-i18n/type-generation ###
${e}
// ###< astro-i18n/type-generation ###`}function ls(e,t){let r=`type ${e} = {`;for(let n of t){let o=ao(n);if(o.length===0){r+=`"${n}":undefined;`;continue}let i="{";for(let s of o)i+=`"${s}":unknown;`;i+="}",r+=`"${n}":${i};`}return`${r}}`}function fs(e,t){let r=`type ${e} = {`;for(let[n,o]of Object.entries(t)){let{interpolationVars:i,variantVars:s,isVariantRequired:c}=o,a="{";for(let l of i)a+=`"${l}"?:unknown;`;s.length>0&&(a+=`"${se}"?:number;`);for(let{name:l,values:u}of s){let p=new Set;for(let h of u){if(!h&&typeof h=="object"){p.add("null");continue}p.add(typeof h)}a+=`"${l}"?:${[...p].join("|")};`}a+=!c||a==="{"?"}|undefined":"}",r+=`"${n}":${a};`}return`${r}}`.replaceAll("{}","object")}var Lr=Eo;var Lo={name:"extract",options:["root"]};async function Oo({command:e,options:t}){if(e!==Lo.name)throw new Y;let{join:r}=await d.path,n=await I(typeof t.root=="string"?t.root:process.cwd());if(!await N(n))throw new H;await S.initialize();let o={},i={},s=await Rt(n,S.internals.config);for(let l of s)bo.exec(await l.getContent(),({match:u})=>{let p=u[2];if(!p)return;let h=o,g=u[1]||"";u[1]?g=u[1].replace(/^#/,"").replace(/#$/,""):(h=i,g=l.route),V(h,[g||y(),S.primaryLocale,p],p);for(let L of S.secondaryLocales)V(h,[g||y(),L,p],`${p}`)});let c={i18n:X,pages:X,...S.internals.config.translationDirectory},a=r(n,S.internals.config.srcDir,c.i18n);for(let[l,u]of Object.entries(o))for(let[p,h]of Object.entries(u)){let g=r(a,l,`${p}.json`),L=await v(g)?await No(g):{};k(L,h,{mode:"fill"}),Q(g,JSON.stringify(L,null,"	"))}for(let[l,u]of Object.entries(i))for(let[p,h]of Object.entries(u)){let g=r(a,D,...l.replace(/^\//,"").replace(/\/$/,"").split("/")),[L,b]=[r(g,`${p}.json`),r(g,c.pages,`${p}.json`)],R=await v(b)?b:"";R||(R=await v(L)?L:"");let x=R?await No(R):{};k(x,h,{mode:"fill"}),Q(R||b,JSON.stringify(x,null,"	"))}}async function No(e){let t=await j(e);return G(t,z),t}var Or=Lo;var vo={name:"install",options:["root","serverless"]};async function ko({command:e,options:t}){if(e!==vo.name)throw new Y;let{writeFileSync:r}=await d.fs,{join:n}=await d.path,o=await I(typeof t.root=="string"?t.root:process.cwd());if(!await N(o))throw new H;let i=await ms(o),s=n(o,"package.json"),c=await v(s)?await j(s):null;c&&Lt(c)&&(k(c,{scripts:{"i18n:extract":"astro-i18n extract","i18n:generate:pages":"astro-i18n generate:pages --purge","i18n:generate:types":"astro-i18n generate:types","i18n:sync":"npm run i18n:generate:pages && npm run i18n:generate:types"}}),r(s,`${JSON.stringify(c,null,"	")}
`)),await(t.serverless?ps(o,i):us(o,i))}async function us(e,t){let{writeFileSync:r,readdirSync:n}=await d.fs,{join:o}=await d.path;await Io(e)||r(o(e,`${E}.config.${t?"ts":"js"}`),`
import { defineAstroI18nConfig } from "astro-i18n"

export default defineAstroI18nConfig({
	primaryLocale: "en", // default app locale
	secondaryLocales: [], // other supported locales
	fallbackLocale: "en", // fallback locale (on missing translation)
	trailingSlash: "never", // "never" or "always"
	run: "client+server", // "client+server" or "server"
	showPrimaryLocale: false, // "/en/about" vs "/about"
	translationLoadingRules: [], // per page group loading
	translationDirectory: {}, // translation directory names
	translations: {}, // { [translation_group1]: { [locale1]: {}, ... } }
	routes: {}, // { [secondary_locale1]: { about: "about-translated", ... } }
})
`.trim()),await _o(e)||Q(o(e,"src","middleware",`index.${t?"ts":"js"}`),`
import { sequence } from "astro/middleware"
import { useAstroI18n } from "astro-i18n"

const astroI18n = useAstroI18n(
	undefined /* config */,
	undefined /* custom formatters */,
)

export const onRequest = sequence(astroI18n)
`.trim());let s=o(e,"src",X),c=!1;for(let a of n(e)){let l=o(e,a);if(await N(l)&&a!=="node_modules"){for(let u of n(l))if(u===F&&await N(u)){c=!0;break}}}!await N(s)&&!c&&Q(o(s,F,"en.json"),`${JSON.stringify({your_common:"translations here",they:{can:"be nested"}},null,"	")}
`)}async function ps(e,t){let{writeFileSync:r}=await d.fs,{join:n}=await d.path;await Io(e)||r(n(e,`${E}.config.${t?"ts":"js"}`),`
import { defineAstroI18nConfig } from "astro-i18n"

export default defineAstroI18nConfig({
	primaryLocale: "en", // default app locale
	secondaryLocales: [], // other supported locales
	fallbackLocale: "en", // fallback locale (on missing translation)
	trailingSlash: "never", // "never" or "always"
	run: "client+server", // "client+server" or "server"
	showPrimaryLocale: false, // "/en/about" vs "/about"
	translationLoadingRules: [], // per page group loading
	translationDirectory: {}, // translation directory names
	translations: {}, // { [translation_group1]: { [locale1]: {}, ... } }
	routes: {}, // { [secondary_locale1]: { about: "about-translated", ... } }
})
`.trim()),await _o(e)||Q(n(e,"src","middleware",`index.${t?"ts":"js"}`),`
import { sequence } from "astro/middleware"
import { useAstroI18n } from "astro-i18n"
import astroI18nConfig from "../../astro-i18n.config"

const astroI18n = useAstroI18n(
	astroI18nConfig,
	undefined /* custom formatters */,
)

export const onRequest = sequence(astroI18n)
`.trim())}async function _o(e){let{readdirSync:t}=await d.fs,{join:r}=await d.path,n=r(e,"src");if(!await N(n))return null;for(let o of t(n)){let i=r(n,o);if(Ao.test(o))return i;if(o==="middleware"&&await N(o)){for(let s of t(i))if(Po.test(o))return r(n,"middleware",s)}}return null}async function Io(e){let{readdirSync:t}=await d.fs,r=_.fromRegex(Jt).assertEnding().build(),n=t(e);for(let o of n)if(await v(o)&&r.test(o))return o;return null}async function ms(e){let{join:t}=await d.path;return v(t(e,"tsconfig.json"))}var vr=vo;var xe=jr([Sr,Lr,Or,vr]),Co={[Sr.name]:Ro,[Lr.name]:So,[Or.name]:Oo,[vr.name]:ko};if(!xe.command||!Co[xe.command])throw new Y;Co[xe.command](xe);
